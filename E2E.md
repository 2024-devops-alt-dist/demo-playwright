# Tests E2E - Guide Complet

## C'est quoi un test E2E ?

**E2E** = **End-to-End** = **De bout en bout**

Un test E2E simule **un utilisateur r√©el** qui utilise votre application du d√©but √† la fin.

### Exemple concret

Imaginez un utilisateur qui veut ajouter une t√¢che dans votre Todo List :

1. üåê Il ouvre son navigateur Chrome
2. üîó Il va sur `https://votre-app.com`
3. üëÄ Il voit le titre "Ma Todo List"
4. ‚úçÔ∏è Il tape "Acheter du pain" dans l'input
5. üñ±Ô∏è Il clique sur le bouton "Ajouter"
6. ‚úÖ Il voit "Acheter du pain" appara√Ætre dans la liste
7. ‚òëÔ∏è Il coche la checkbox pour marquer la t√¢che comme compl√©t√©e
8. ‚ùå Il clique sur le bouton de suppression
9. üëã La t√¢che dispara√Æt de la liste

**Un test E2E automatise EXACTEMENT ce parcours.**

## E2E vs Tests Unitaires vs Tests d'Int√©gration

### üß™ Tests Unitaires (Jest, Vitest)

**Testent** : Une fonction isol√©e, un composant isol√©

**Exemple** :
```javascript
// Tester une fonction pure
function addTodo(todos, newTodo) {
  return [...todos, newTodo];
}

test('addTodo ajoute une t√¢che', () => {
  const result = addTodo([], { id: 1, text: 'Test' });
  expect(result).toHaveLength(1);
});
```

**Avantages** :
- ‚úÖ Super rapides (millisecondes)
- ‚úÖ Faciles √† d√©bugger
- ‚úÖ Testent la logique m√©tier

**Inconv√©nients** :
- ‚ùå Ne testent pas l'int√©gration entre composants
- ‚ùå Ne testent pas le vrai navigateur
- ‚ùå Ne garantissent pas que l'app fonctionne pour l'utilisateur

### üß© Tests d'Int√©gration (React Testing Library)

**Testent** : L'interaction entre plusieurs composants, le DOM virtuel

**Exemple** :
```javascript
import { render, screen, fireEvent } from '@testing-library/react';

test('peut ajouter une t√¢che', () => {
  render(<TodoApp />);

  const input = screen.getByPlaceholderText('Ajouter une t√¢che...');
  const button = screen.getByRole('button', { name: 'Ajouter' });

  fireEvent.change(input, { target: { value: 'Test' } });
  fireEvent.click(button);

  expect(screen.getByText('Test')).toBeInTheDocument();
});
```

**Avantages** :
- ‚úÖ Rapides (quelques secondes)
- ‚úÖ Testent les interactions utilisateur
- ‚úÖ Testent le rendu des composants React
- ‚úÖ Pas besoin de vrai navigateur

**Inconv√©nients** :
- ‚ùå Utilisent un DOM virtuel (jsdom), pas un vrai navigateur
- ‚ùå Ne testent pas le CSS, les animations, les vraies API
- ‚ùå Ne d√©tectent pas les bugs cross-browser

### üåê Tests E2E (Playwright, Cypress)

**Testent** : L'application compl√®te dans un vrai navigateur

**Exemple** :
```typescript
test('peut ajouter une t√¢che', async ({ page }) => {
  await page.goto('http://localhost:5173');

  await page.getByPlaceholder('Ajouter une t√¢che...').fill('Test');
  await page.getByRole('button', { name: 'Ajouter' }).click();

  await expect(page.getByText('Test')).toBeVisible();
});
```

**Avantages** :
- ‚úÖ Testent l'exp√©rience utilisateur r√©elle
- ‚úÖ D√©tectent les bugs CSS, animations, API
- ‚úÖ Testent sur plusieurs navigateurs (Chrome, Firefox, Safari)
- ‚úÖ Capturent des screenshots et vid√©os des √©checs
- ‚úÖ Confiance maximale que l'app fonctionne

**Inconv√©nients** :
- ‚ùå Plus lents (quelques secondes par test)
- ‚ùå Plus complexes √† maintenir
- ‚ùå Peuvent √™tre "flaky" (instables) si mal √©crits

## Pyramide des Tests

La pyramide des tests recommande :

```
        /\
       /E2E\      ‚Üê Peu de tests E2E (critiques)
      /------\
     /Int√©gr.\   ‚Üê Tests d'int√©gration (principaux)
    /----------\
   / Unitaires \  ‚Üê Beaucoup de tests unitaires (base)
  /--------------\
```

**Pourquoi cette pyramide ?**

- **Tests unitaires** : Rapides, nombreux, testent la logique m√©tier
- **Tests d'int√©gration** : Testent les interactions entre composants
- **Tests E2E** : Lents, co√ªteux, mais testent les parcours critiques

## Quoi tester avec E2E (Playwright) ?

### ‚úÖ Testez les parcours utilisateurs critiques

**Parcours qui rapportent de l'argent ou sont essentiels** :
- üõí **E-commerce** : Ajouter au panier ‚Üí Payer ‚Üí Confirmation
- üîê **Authentification** : S'inscrire ‚Üí Se connecter ‚Üí Se d√©connecter
- üìù **Todo List** : Ajouter une t√¢che ‚Üí Compl√©ter ‚Üí Supprimer
- üìä **Dashboard** : Voir les donn√©es ‚Üí Filtrer ‚Üí Exporter

### ‚úÖ Testez les interactions complexes

- **Multi-√©tapes** : Formulaires avec plusieurs pages
- **Drag & Drop** : D√©placer des √©l√©ments
- **Uploads** : T√©l√©charger des fichiers
- **Modals/Popups** : Ouvrir/Fermer des fen√™tres
- **Navigation** : Aller d'une page √† l'autre

### ‚úÖ Testez ce qui ne peut pas √™tre test√© autrement

- **CSS et Layout** : V√©rifier qu'un √©l√©ment est visible √† l'√©cran
- **Animations** : Transitions, effets visuels
- **APIs externes** : Appels r√©seau r√©els
- **LocalStorage/Cookies** : Persistence des donn√©es
- **Cross-browser** : Chrome, Firefox, Safari

### ‚ùå NE testez PAS avec E2E

**Logique m√©tier pure** :
```javascript
// ‚ùå Mauvais : E2E pour tester une fonction
test('addTodo ajoute une t√¢che', async ({ page }) => {
  // Lancer le navigateur juste pour tester une fonction...
});

// ‚úÖ Bon : Test unitaire
test('addTodo ajoute une t√¢che', () => {
  expect(addTodo([], { id: 1 })).toHaveLength(1);
});
```

**Cas d'erreur de chaque composant** :
```javascript
// ‚ùå Mauvais : Tester tous les cas d'erreur en E2E
test('input affiche erreur si vide', async ({ page }) => {
  // Trop sp√©cifique pour E2E
});

// ‚úÖ Bon : Test d'int√©gration (React Testing Library)
test('input affiche erreur si vide', () => {
  render(<TodoInput />);
  fireEvent.submit(screen.getByRole('button'));
  expect(screen.getByText('Champ requis')).toBeInTheDocument();
});
```

**Edge cases et validations** :
- Validation de formulaire (champs requis, format email, etc.)
- Gestion d'erreur de chaque composant
- √âtats de chargement de chaque composant

**Testez ces cas avec des tests unitaires/int√©gration !**

## Playwright vs React Testing Library

### üé≠ Playwright (E2E)

**Utiliser pour** :
- Tester les **parcours utilisateurs complets**
- V√©rifier que l'**application fonctionne de bout en bout**
- Tester sur **plusieurs navigateurs**
- Tester les **int√©grations avec des APIs r√©elles**
- Garantir que **l'utilisateur peut accomplir sa t√¢che**

**Exemples de tests Playwright** :
- ‚úÖ Un utilisateur peut s'inscrire, se connecter, et publier un article
- ‚úÖ Un utilisateur peut ajouter 3 t√¢ches, en compl√©ter une, et en supprimer une
- ‚úÖ Un utilisateur peut filtrer les produits et ajouter au panier
- ‚úÖ Un utilisateur peut uploader une image et voir la pr√©visualisation

### ‚öõÔ∏è React Testing Library (Int√©gration)

**Utiliser pour** :
- Tester le **comportement d'un composant React**
- V√©rifier les **interactions utilisateur simples**
- Tester le **rendu conditionnel**
- V√©rifier les **props et √©tats** des composants
- Tests **rapides** pendant le d√©veloppement

**Exemples de tests React Testing Library** :
- ‚úÖ Le composant TodoItem affiche le texte pass√© en props
- ‚úÖ Cliquer sur la checkbox appelle la fonction onToggle
- ‚úÖ Le bouton de suppression affiche une confirmation
- ‚úÖ Le composant affiche un loader pendant le chargement
- ‚úÖ Le formulaire affiche une erreur si les champs sont vides

## Tableau comparatif

| Crit√®re | Tests Unitaires | React Testing Library | Playwright (E2E) |
|---------|----------------|----------------------|-----------------|
| **Vitesse** | ‚ö°‚ö°‚ö° Millisecondes | ‚ö°‚ö° Secondes | ‚ö° Quelques secondes |
| **Environnement** | Node.js | jsdom (DOM virtuel) | Vrai navigateur |
| **Scope** | Une fonction | Un/plusieurs composants | Application compl√®te |
| **Confiance** | üîµ Faible | üü° Moyenne | üü¢ √âlev√©e |
| **Maintenance** | ‚úÖ Facile | ‚úÖ Facile | ‚ö†Ô∏è Plus complexe |
| **Quand lancer** | √Ä chaque sauvegarde | Avant commit | Avant deploy / En CI |
| **Combien ?** | 100-1000+ tests | 50-200 tests | 10-50 tests |

## Strat√©gie de tests pour une Todo List

### Tests Unitaires (Jest/Vitest)

```javascript
// Tester la logique m√©tier pure
describe('Todo utils', () => {
  test('addTodo ajoute une t√¢che', () => {
    const todos = [];
    const result = addTodo(todos, { id: 1, text: 'Test' });
    expect(result).toHaveLength(1);
  });

  test('toggleTodo change le statut', () => {
    const todos = [{ id: 1, text: 'Test', completed: false }];
    const result = toggleTodo(todos, 1);
    expect(result[0].completed).toBe(true);
  });

  test('deleteTodo supprime une t√¢che', () => {
    const todos = [{ id: 1, text: 'Test' }];
    const result = deleteTodo(todos, 1);
    expect(result).toHaveLength(0);
  });
});
```

**Combien ?** 10-20 tests unitaires

### Tests d'Int√©gration (React Testing Library)

```javascript
// Tester le comportement des composants React
describe('TodoApp', () => {
  test('affiche la liste vide au d√©marrage', () => {
    render(<TodoApp />);
    expect(screen.getByText('Aucune t√¢che')).toBeInTheDocument();
  });

  test('affiche une erreur si input vide', () => {
    render(<TodoApp />);
    fireEvent.click(screen.getByRole('button', { name: 'Ajouter' }));
    expect(screen.getByText('Champ requis')).toBeInTheDocument();
  });

  test('peut ajouter une t√¢che', () => {
    render(<TodoApp />);
    const input = screen.getByPlaceholderText('Ajouter une t√¢che...');
    fireEvent.change(input, { target: { value: 'Test' } });
    fireEvent.click(screen.getByRole('button', { name: 'Ajouter' }));
    expect(screen.getByText('Test')).toBeInTheDocument();
  });
});
```

**Combien ?** 5-10 tests d'int√©gration

### Tests E2E (Playwright)

```typescript
// Tester les parcours utilisateurs complets
test.describe('Todo List E2E', () => {
  test('workflow complet: ajouter, compl√©ter, supprimer', async ({ page }) => {
    await page.goto('/');

    // Ajouter 3 t√¢ches
    await page.getByPlaceholder('Ajouter une t√¢che...').fill('T√¢che 1');
    await page.getByRole('button', { name: 'Ajouter' }).click();

    await page.getByPlaceholder('Ajouter une t√¢che...').fill('T√¢che 2');
    await page.getByRole('button', { name: 'Ajouter' }).click();

    await page.getByPlaceholder('Ajouter une t√¢che...').fill('T√¢che 3');
    await page.getByRole('button', { name: 'Ajouter' }).click();

    // Compl√©ter la 2√®me t√¢che
    const checkbox = page.locator('li').filter({ hasText: 'T√¢che 2' }).getByRole('checkbox');
    await checkbox.check();
    await expect(checkbox).toBeChecked();

    // Supprimer la 1√®re t√¢che
    await page.locator('li').filter({ hasText: 'T√¢che 1' }).getByRole('button', { name: '‚úï' }).click();

    // V√©rifications finales
    await expect(page.getByText('T√¢che 1')).not.toBeVisible();
    await expect(page.getByText('T√¢che 2')).toBeVisible();
    await expect(page.getByText('T√¢che 3')).toBeVisible();
  });
});
```

**Combien ?** 3-5 tests E2E (parcours critiques uniquement)

## R√®gles d'or pour d√©cider

### Utilisez des tests unitaires si...

- ‚úÖ Vous testez une **fonction pure** (pas d'effets de bord)
- ‚úÖ Vous testez de la **logique m√©tier**
- ‚úÖ Vous voulez des tests **ultra-rapides**
- ‚úÖ Vous testez des **calculs, transformations, validations**

**Exemples** : `calculateTotal()`, `formatDate()`, `validateEmail()`

### Utilisez React Testing Library si...

- ‚úÖ Vous testez le **rendu d'un composant React**
- ‚úÖ Vous testez les **interactions simples** (click, change)
- ‚úÖ Vous testez les **props et √©tats** d'un composant
- ‚úÖ Vous voulez des tests **rapides** pendant le d√©veloppement
- ‚úÖ Vous testez le **rendu conditionnel**

**Exemples** : `TodoItem`, `TodoInput`, `TodoList`, `Button`

### Utilisez Playwright (E2E) si...

- ‚úÖ Vous testez un **parcours utilisateur complet**
- ‚úÖ Vous testez l'**int√©gration avec des APIs r√©elles**
- ‚úÖ Vous testez sur **plusieurs navigateurs**
- ‚úÖ Vous testez des **fonctionnalit√©s critiques** pour le business
- ‚úÖ Vous voulez garantir que **l'utilisateur final peut accomplir sa t√¢che**

**Exemples** : Workflow d'inscription, Processus de paiement, Parcours Todo complet

## Exemple concret : "Ajouter une t√¢che"

### ‚ùå Mauvais : Tout tester en E2E

```typescript
// Ne faites PAS √ßa ! Trop de tests E2E
test('input vide affiche erreur', async ({ page }) => { ... }); // ‚ùå RTL
test('input avec espaces est refus√©', async ({ page }) => { ... }); // ‚ùå RTL
test('input > 100 caract√®res est refus√©', async ({ page }) => { ... }); // ‚ùå Unitaire
test('peut ajouter une t√¢che', async ({ page }) => { ... }); // ‚úÖ E2E
test('peut ajouter 10 t√¢ches', async ({ page }) => { ... }); // ‚ùå Unitaire
test('peut ajouter avec Entr√©e', async ({ page }) => { ... }); // ‚úÖ E2E
```

### ‚úÖ Bon : R√©partir intelligemment

**Tests unitaires** (rapides, nombreux) :
```javascript
test('validateTodoText rejette texte vide');
test('validateTodoText rejette texte > 100 caract√®res');
test('validateTodoText accepte texte valide');
```

**Tests d'int√©gration RTL** (composants React) :
```javascript
test('TodoInput affiche erreur si vide');
test('TodoInput appelle onAdd avec le texte');
test('TodoInput vide le champ apr√®s ajout');
```

**Tests E2E Playwright** (parcours utilisateur) :
```typescript
test('peut ajouter une t√¢che et la voir dans la liste');
test('peut ajouter avec la touche Entr√©e');
```

## R√©sum√©

üéØ **Tests unitaires** ‚Üí Logique m√©tier pure, fonctions isol√©es
‚öõÔ∏è **React Testing Library** ‚Üí Comportement des composants React
üé≠ **Playwright** ‚Üí Parcours utilisateurs complets

**La bonne strat√©gie** :
- 80% de tests unitaires (rapides, nombreux)
- 15% de tests d'int√©gration (composants React)
- 5% de tests E2E (parcours critiques)

**Ne testez pas tout en E2E !** C'est lent, co√ªteux, et difficile √† maintenir.

**Testez intelligemment** : Chaque type de test a son r√¥le ! üöÄ
